<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ein Tool zum Speichern von Texten im Gehirn</title>
    <style>
        body { font-family: Arial, sans-serif; }
        .container { max-width: 800px; margin: auto; padding: 20px; }
        .hidden { display: none; }
        textarea { width: 100%; }
        .controls button { margin: 5px; }
        .whatsapp-button { display: inline-block; padding: 10px 20px; color: #fff; background-color: #25D366; text-decoration: none; border-radius: 5px; }
        .whatsapp-button:hover { background-color: #128C7E; }
    </style>
</head>
<body>
    <header>Ein Tool zum Speichern von Texten im Gehirn</header>

    <div id="mainContent" class="container">
        <h2>Text und Spracheinstellungen</h2>
        <textarea id="germanText" placeholder="Geben Sie hier den gesamten deutschen Text ein..." rows="6"></textarea><br>
        <label for="translationLang">Wählen Sie die Übersetzungssprache:</label>
        <select id="translationLang">
            <option value="ar">Arabisch</option>
            <option value="uk">Ukrainisch</option>
            <option value="tr">Türkisch</option>
        </select><br>
        <button onclick="startPresentation()">Start Präsentation</button>
    </div>

    <div id="presentationSection" class="container hidden">
        <h2>Präsentation</h2>
        <div id="currentSentence" class="sentence"></div>
        <div id="currentTranslation" class="translation"></div>
        <div class="controls">
            <button id="prevBtn" onclick="prevSentence()">Vorherige</button>
            <button id="nextBtn" onclick="nextSentence()">Nächste</button>
            <button id="stopBtn" onclick="togglePlayback()">Stoppen</button>
        </div>
    </div>

    <div class="container">
        <div class="info">
            <h2>Wie man das Tool verwendet:</h2>
            <ol>
                <li><strong>Geben Sie den gesamten deutschen Text ein:</strong> Schreiben Sie den vollständigen deutschen Text in das Textfeld.</li>
                <li><strong>Wählen Sie die Sprache für die Übersetzung:</strong> Wählen Sie eine der verfügbaren Sprachen (Arabisch, Ukrainisch oder Türkisch) aus der Dropdown-Liste aus.</li>
                <li><strong>Klicken Sie auf "Start Präsentation":</strong> Dies wird den deutschen Text automatisch in Sätze aufteilen, übersetzen und diese in der ausgewählten Übersetzung anzeigen.</li>
                <li><strong>Verwenden Sie die Tasten "Vorherige" und "Nächste":</strong> Um zwischen den Sätzen zu wechseln. Der Text wird in deutscher Sprache vorgelesen und die Übersetzung angezeigt.</li>
            </ol>
            <h2>Erstellt von:</h2>
            <p>Majd Albdiwi</p>
            <p>Telefon: +4917624128422</p>
            <p>Email: Majd.albdiwi@gmail.com</p>
            <a href="https://wa.me/+4917624128422" class="whatsapp-button">Kontaktieren Sie uns auf WhatsApp</a>
        </div>
    </div>

    <script>
        let sentences = [];
        let currentIndex = 0;
        let isPlaying = false;
        let utterance = null;
        let playbackInterval = null;

        async function startPresentation() {
            const germanText = document.getElementById('germanText').value;
            const targetLang = document.getElementById('translationLang').value;

            if (!germanText) {
                alert('Bitte geben Sie einen Text ein.');
                return;
            }

            sentences = splitTextIntoSentences(germanText);
            document.getElementById('mainContent').classList.add('hidden');
            document.getElementById('presentationSection').classList.remove('hidden');
            currentIndex = 0;
            displayCurrentSentence();
        }

        function splitTextIntoSentences(text) {
            return text.split(/(?<=[.!?])\s+/); // Split text by punctuation followed by whitespace
        }

        async function displayCurrentSentence() {
            if (currentIndex < sentences.length) {
                const sentence = sentences[currentIndex];
                const translation = await getTranslation(sentence, document.getElementById('translationLang').value);

                document.getElementById('currentSentence').innerText = sentence;
                document.getElementById('currentTranslation').innerText = translation;

                if (utterance) {
                    window.speechSynthesis.cancel(); // Stop any current speech
                }

                utterance = new SpeechSynthesisUtterance(sentence);
                utterance.lang = 'de-DE';
                utterance.onerror = function(event) {
                    console.error('Error occurred while speaking:', event.error);
                    alert('Fehler beim Abspielen des Textes.');
                };
                utterance.onend = () => {
                    if (isPlaying) {
                        nextSentence(); // Automatically go to the next sentence when done
                    }
                };
                window.speechSynthesis.speak(utterance);
            }
        }

        function prevSentence() {
            if (currentIndex > 0) {
                currentIndex--;
                displayCurrentSentence();
            }
        }

        function nextSentence() {
            if (currentIndex < sentences.length - 1) {
                currentIndex++;
                displayCurrentSentence();
            }
        }

        function togglePlayback() {
            if (isPlaying) {
                window.speechSynthesis.cancel();
                isPlaying = false;
                document.getElementById('stopBtn').innerText = 'Fortsetzen';
                if (playbackInterval) {
                    clearInterval(playbackInterval);
                    playbackInterval = null;
                }
            } else {
                isPlaying = true;
                document.getElementById('stopBtn').innerText = 'Stoppen';
                displayCurrentSentence();
                playbackInterval = setInterval(() => {
                    if (isPlaying && currentIndex < sentences.length - 1) {
                        nextSentence();
                    }
                }, 5000); // Change the interval as needed
            }
        }

        async function getTranslation(text, targetLang) {
            try {
                // Attempt translation using multiple sources
                const libreTranslateUrl = 'https://libretranslate.de/translate';
                const otherSourceUrl = 'https://api-free.deepl.com/v2/translate';

                // First, try LibreTranslate
                let response = await fetch(libreTranslateUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        q: text,
                        source: 'de',
                        target: targetLang,
                        format: 'text'
                    })
                });

                let data = await response.json();
                if (data.translatedText) {
                    return data.translatedText;
                }

                // Fallback to another service
                response = await fetch(otherSourceUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        'Authorization': 'DeepL-Auth-Key YOUR_API_KEY' // Replace with actual API Key if needed
                    },
                    body: new URLSearchParams({
                        text: text,
                        source_lang: 'DE',
                        target_lang: targetLang
                    })
                });

                data = await response.json();
                if (data.translations && data.translations[0]) {
                    return data.translations[0].text;
                }

                // If both services fail, return the original text
                return text;
            } catch (error) {
                console.error('Translation Error:', error);
                return text; // Fallback to original text if translation fails
            }
        }
    </script>
</body>
</html>
